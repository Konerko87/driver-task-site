<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¸æ©Ÿä»Šæ—¥ä»»å‹™</title>
  <style>
    :root{
      --bg:#070A14;
      --bg2:#0B1020;

      --text:#EAF0FF;
      --muted:rgba(234,240,255,.62);

      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.06);
      --glass:rgba(18,26,51,.62);

      --accent: rgba(198, 170, 110, .95);
      --ice: rgba(140, 196, 255, .95);

      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --shadow2: 0 10px 24px rgba(0,0,0,.32);

      --r-card:18px;
      --r-box:16px;
      --r-acc:14px;
      --r-chip:999px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
      background:
        radial-gradient(900px 520px at 18% 0%, rgba(76,112,255,.22) 0%, rgba(7,10,20,0) 55%),
        radial-gradient(760px 460px at 88% 12%, rgba(198,170,110,.14) 0%, rgba(7,10,20,0) 58%),
        radial-gradient(700px 520px at 50% 110%, rgba(140,196,255,.10) 0%, rgba(7,10,20,0) 60%),
        linear-gradient(180deg, var(--bg2) 0%, var(--bg) 100%);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .wrap{max-width:980px;margin:0 auto;padding:18px}

    .topbar{
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      padding:14px;border:1px solid var(--line);border-radius:18px;
      background:rgba(18,26,51,.65);
      backdrop-filter: blur(12px) saturate(140%);
      box-shadow: var(--shadow2);
      position:relative;
    }
    .topbar:before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:19px;
      padding:1px;
      background: linear-gradient(120deg, rgba(198,170,110,.35), rgba(255,255,255,.10), rgba(140,196,255,.28));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.75;
    }

    .brand h1{font-size:16px;margin:0;letter-spacing:.2px}
    .brand .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .spacer{flex:1}

    .hint{font-size:12px;color: var(--muted);opacity:.9}

    select,button,input{
      border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.10) 0%, rgba(255,255,255,.04) 100%);
      color:var(--text);
      padding:10px 12px;font-size:14px;
      outline:none;
      box-shadow: 0 1px 0 rgba(255,255,255,.12) inset, 0 10px 18px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease, background .12s ease;
    }
    select{padding-right:34px}
    input{min-width:180px}
    button{cursor:pointer;position:relative;font-weight:800;letter-spacing:.2px}
    button:before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:13px;
      padding:1px;
      background: linear-gradient(120deg, rgba(198,170,110,.55), rgba(255,255,255,.10), rgba(140,196,255,.40));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.9;
    }
    select:hover,button:hover,input:hover{
      border-color: rgba(255,255,255,.20);
      box-shadow: 0 1px 0 rgba(255,255,255,.14) inset, 0 16px 26px rgba(0,0,0,.28);
      transform: translateY(-1px);
    }
    select:active,button:active{transform: translateY(0px)}

    .grid{display:flex;flex-direction:column;gap:14px;margin-top:14px}

    .card{
      border:1px solid var(--line);border-radius:18px;
      background:rgba(18,26,51,.65);padding:14px;
      backdrop-filter: blur(12px) saturate(140%);
      box-shadow: var(--shadow);
      position:relative;
    }
    .card:before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:19px;
      padding:1px;
      background: linear-gradient(120deg, rgba(140,196,255,.22), rgba(255,255,255,.08), rgba(198,170,110,.22));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.55;
    }
    .card h2{font-size:14px;margin:0 0 10px;color:#cfe0ff;font-weight:900;letter-spacing:.2px}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color: rgba(234,240,255,.92);
    }
    .pill.ok{border-color:rgba(140,196,255,.26);background:rgba(140,196,255,.10)}
    .pill.warn{border-color:rgba(198,170,110,.30);background:rgba(198,170,110,.10)}
    .pill.bad{border-color:rgba(255,90,90,.30);background:rgba(255,90,90,.14)}
    .muted{color:var(--muted);font-size:12px}

    details{border:1px solid var(--line2);border-radius:14px;background:rgba(255,255,255,.03);overflow:hidden}
    details+details{margin-top:8px}
    summary{
      cursor:pointer;list-style:none;
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .accBody{padding:10px;display:flex;flex-direction:column;gap:8px}
    .divider{height:1px;background: rgba(255,255,255,.10);margin:4px 0;}

    .task{
      display:grid;grid-template-columns:56px 1fr 70px;
      gap:8px;align-items:center;
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03)
    }
    .tag{font-weight:900;font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.10)}
    .tag.h{background:rgba(255,90,90,.22);border-color:rgba(255,90,90,.30)}
    .tag.s{background:rgba(140,196,255,.18);border-color:rgba(140,196,255,.26)}
    .tag.n{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.10)}
    .route{min-width:0;}
    .route .main{font-weight:900;word-break:break-word;overflow-wrap:anywhere}
    .route .sub{font-size:11px;color:var(--muted);margin-top:2px;line-height:1.3;word-break:break-word;overflow-wrap:anywhere}
    .boards{font-weight:900;text-align:right}

    .miniRow{
      display:flex;align-items:flex-start;justify-content:space-between;
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04)
    }
    .miniLeft{display:flex;flex-direction:column;gap:2px}
    .miniTitle{font-size:13px;font-weight:900;line-height:1.35;white-space:normal}
    .miniSub{font-size:11px;color:var(--muted);line-height:1.35;white-space:normal;word-break:break-word;overflow-wrap:anywhere}

    .empty{font-size:12px;color:var(--muted)}
    .dangerBox{
      border:1px solid rgba(255,90,90,.28);
      background:rgba(255,90,90,.10);
      border-radius:14px;
      padding:12px;
    }
  </style>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
         <h1 id="title">å¸æ©Ÿä»Šæ—¥ä»»å‹™</h1>
         <div class="sub" id="subtitle">åˆå§‹åŒ–ä¸­â€¦</div>
      </div>

      <div class="spacer"></div>

      <div class="row">
        <span class="hint">æ—¥æœŸ</span>
        <select id="dateSelect" aria-label="æ—¥æœŸé¸æ“‡"></select>
        <button id="btnReload">é‡æ–°è¼‰å…¥</button>
      </div>
    </div>

    <div class="grid">
      <!-- Status -->
      <div class="card">
        <h2>ğŸ“Œ ç‹€æ…‹</h2>
        <div class="row" style="margin-bottom:8px">
          <span class="pill" id="pillLiff">LIFFï¼šâ€”</span>
          <span class="pill" id="pillBind">ç¶å®šï¼šâ€”</span>
          <span class="pill" id="pillTasks">ä»»å‹™ï¼šâ€”</span>
        </div>
        <div class="muted" id="todayLine">ä»Šå¤©ï¼šâ€”</div>
        <div class="muted" id="userLine">LINE IDï¼šâ€”</div>
      </div>

      <!-- Bind -->
      <div class="card" id="bindCard" style="display:none;">
        <h2>ğŸ” å¸æ©Ÿç¶å®š</h2>
        <div class="muted" style="margin-bottom:10px">
          ç¬¬ä¸€æ¬¡ä½¿ç”¨è«‹è¼¸å…¥ã€Œå§“å(è½‰) æˆ– å§“å(å€)ã€ã€‚<br/>
          ç³»çµ±æœƒå¿½ç•¥æ•¸å­—ï¼ˆä¾‹å¦‚ï¼š5å¾å»·é †1 ä¹Ÿå¯è¼¸å…¥ å¾å»·é †ï¼‰ã€‚
        </div>
        <div class="row">
          <input id="inpName" placeholder="è«‹è¼¸å…¥å§“åï¼ˆä¾‹å¦‚ï¼šå¾å»·é †ï¼‰" />
          <button id="btnBind">ç¶å®š</button>
        </div>
        <div class="muted" style="margin-top:10px">ç¶å®šå¾Œæœƒè‡ªå‹•è¼‰å…¥ä»»å‹™ã€‚</div>
      </div>

      <!-- Tasks -->
      <div class="card" id="taskCard" style="display:none;">
        <h2>ğŸšš æˆ‘çš„ä»»å‹™</h2>

        <div id="tasksWrap"></div>
        <div class="empty" id="noTasks" style="display:none;">ç›®å‰æ²’æœ‰ä»»å‹™</div>
      </div>

      <!-- Friendly error -->
      <div class="card" id="errCard" style="display:none;">
        <h2>âš ï¸ ç„¡æ³•è®€å–</h2>
        <div class="dangerBox">
          <div style="font-weight:900;margin-bottom:6px">ç›®å‰ç„¡æ³•è®€å–ä»»å‹™ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯çµ¡ç®¡ç†å“¡ã€‚</div>
          <details style="margin-top:10px">
            <summary>è©³ç´°è³‡è¨Š</summary>
            <div class="accBody">
              <div class="muted" id="errDetail">â€”</div>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>

<script>
  // ====== CONFIG (å¿…å¡«) ======
  const LIFF_ID = "2008915809-vp9PFMVX";
  const GAS_EXEC_URL = "https://script.google.com/macros/s/AKfycbxY-cAz9uSlEo44YA7GAp6DYtAog3VTxLWWSAesQKiok2w2HxkOVOe_UnhNw5nV9K5C/exec";

  // ====== helpers ======
  const el = (id) => document.getElementById(id);
  const safeText = (v) => (v === null || v === undefined) ? '' : String(v);
  const num = (v) => Number(v || 0);

  function gradeClass(g){
    if (g === 'H') return 'h';
    if (g === 'S') return 's';
    return 'n';
  }
  function show(id, on){ el(id).style.display = on ? '' : 'none'; }
  function setSubtitle(msg){ el('subtitle').textContent = msg; }
  function setPill(id, text, cls){
    const p = el(id);
    p.textContent = text;
    p.classList.remove('ok','warn','bad');
    if (cls) p.classList.add(cls);
  }
  function normalizeNameInput(s){
    return safeText(s).trim().replace(/\s+/g,'').replace(/[0-9ï¼-ï¼™]/g,'');
  }

  // âœ… å–ã€Œå°¾å·´æ•¸å­—ã€ç•¶é †åºï¼ˆç„¡å‰‡ nullï¼‰
  function tailSeq(name){
    const s = safeText(name).trim().replace(/\s+/g,'');
    if (!s) return null;
    const m = s.match(/(\d+)$/);
    return m ? Number(m[1]) : null;
  }

  // JSONP
  function jsonp(url){
    return new Promise((resolve, reject) => {
      const cbName = "cb_" + Math.random().toString(36).slice(2);
      const sep = url.includes("?") ? "&" : "?";
      const full = url + sep + "callback=" + cbName;

      const script = document.createElement("script");
      const timeout = setTimeout(() => {
        cleanup();
        reject(new Error("JSONP timeout"));
      }, 12000);

      function cleanup(){
        clearTimeout(timeout);
        try { delete window[cbName]; } catch(e) { window[cbName] = undefined; }
        if (script && script.parentNode) script.parentNode.removeChild(script);
      }

      window[cbName] = (data) => { cleanup(); resolve(data); };
      script.onerror = () => { cleanup(); reject(new Error("JSONP load error")); };
      script.src = full;
      document.body.appendChild(script);
    });
  }

  function buildFiveDayOptions(opt){
    return [
      { key:'dMinus2', label:'D-2', tab: opt.dMinus2 },
      { key:'dMinus1', label:'D-1', tab: opt.dMinus1 },
      { key:'d',      label:'D',   tab: opt.d },
      { key:'dPlus1', label:'D+1', tab: opt.dPlus1 },
      { key:'dPlus2', label:'D+2', tab: opt.dPlus2 },
    ];
  }

  function renderDateSelect(selectEl, opt){
    selectEl.innerHTML = '';
    const arr = buildFiveDayOptions(opt);

    arr.forEach(x => {
      const o = document.createElement('option');
      o.value = x.tab || '';
      o.textContent = x.tab ? `${x.label}ï¼ˆ${x.tab}ï¼‰` : `${x.label}ï¼ˆç„¡åˆ†é ï¼‰`;
      o.disabled = !x.tab;
      selectEl.appendChild(o);
    });

    // é è¨­é¸ D
    const idxD = arr.findIndex(x => x.key === 'd');
    if (idxD >= 0) selectEl.selectedIndex = idxD;
  }

  function renderTasks(me){
    const wrap = el('tasksWrap');
    wrap.innerHTML = '';

    const transfer = (me && me.transfer && me.transfer.items) ? me.transfer.items : [];
    const area = (me && me.area && me.area.items) ? me.area.items : [];

    const total = transfer.length + area.length;
    show('noTasks', total === 0);

    // ---- Transfer section ----
    const tBox = document.createElement('div');
    tBox.innerHTML = `<div class="muted" style="margin:4px 0 10px">è½‰é‹ï¼ˆä¾å°¾å·´æ•¸å­—æ’åºï¼‰</div>`;
    wrap.appendChild(tBox);

    if (!transfer.length){
      const e = document.createElement('div');
      e.className = 'empty';
      e.textContent = 'ä»Šæ—¥ç„¡è½‰é‹ä»»å‹™';
      wrap.appendChild(e);
    } else {
      // âœ… è½‰é‹ï¼šä¾ã€Œå°¾å·´æ•¸å­—ã€æ’åºï¼ˆåŒé †åºå†æ¯” boardsï¼‰
      const tSorted = transfer.slice().sort((a,b)=>{
        const sa = tailSeq(a.driver || '') ?? 999999;
        const sb = tailSeq(b.driver || '') ?? 999999;
        if (sa !== sb) return sa - sb;
        return num(b.boards) - num(a.boards);
      });

      tSorted.forEach(t => {
        const tag = (safeText(t.grade).toUpperCase() || 'S');
        const meta = [];
        if (t.carNo) meta.push(`è»Šè™Ÿ:${safeText(t.carNo)}`);
        if (t.owner) meta.push(`è²¨ä¸»:${safeText(t.owner)}`);
        if (t.note)  meta.push(`å‚™è¨»:${safeText(t.note)}`);

        const div = document.createElement('div');
        div.className = 'task';
        div.innerHTML = `
          <div class="tag ${gradeClass(tag)}">${tag}</div>
          <div class="route">
            <div class="main">${safeText(t.pickup)} â†’ ${safeText(t.dropoff)}</div>
            <div class="sub">${meta.join(' ï½œ ')}</div>
          </div>
          <div class="boards">${num(t.boards)} ç‰ˆ</div>
        `;
        wrap.appendChild(div);
      });
    }

    // Divider
    const d = document.createElement('div');
    d.className = 'divider';
    d.style.margin = '12px 0';
    wrap.appendChild(d);

    // ---- Area section ----
    const aBox = document.createElement('div');
    aBox.innerHTML = `<div class="muted" style="margin:4px 0 10px">å€é…ï¼ˆä¾ seq æ’åºï¼Œé»é–‹çœ‹åœ°å€ï¼‰</div>`;
    wrap.appendChild(aBox);

    if (!area.length){
      const e = document.createElement('div');
      e.className = 'empty';
      e.textContent = 'ä»Šæ—¥ç„¡å€é…ä»»å‹™';
      wrap.appendChild(e);
    } else {
      // âœ… å€é…ï¼šä¾ seqï¼ˆå°¾å·´æ•¸å­—ï¼‰æ’åº
      const sorted = area.slice().sort((a,b)=>{
        const sa = (a.seq === null || a.seq === undefined) ? 999999 : Number(a.seq);
        const sb = (b.seq === null || b.seq === undefined) ? 999999 : Number(b.seq);
        if (sa !== sb) return sa - sb;
        return num(b.boards) - num(a.boards);
      });

      sorted.forEach(t => {
        const tag = (safeText(t.grade).toUpperCase() || 'S');
        const meta = [];
        if (t.owner) meta.push(`è²¨ä¸»:${safeText(t.owner)}`);
        if (t.note)  meta.push(`å‚™è¨»:${safeText(t.note)}`);

        const seqText = (t.seq !== null && t.seq !== undefined) ? `é †åº ${t.seq}ï¼š` : '';
        const main = `${safeText(t.pickup)} â†’ ${safeText(t.dropLabel || t.receiver || t.dropoff)}`;

        const det = document.createElement('details');
        det.style.marginTop = '8px';
        det.innerHTML = `
          <summary style="display:grid;grid-template-columns:56px 1fr 70px;gap:8px;align-items:center;">
            <div class="tag ${gradeClass(tag)}">${tag}</div>
            <div class="route">
              <div class="main">${seqText}${main}</div>
              <div class="sub">${meta.join(' ï½œ ')}</div>
            </div>
            <div class="boards">${num(t.boards)} ç‰ˆ</div>
          </summary>
          <div class="accBody">
            <div class="miniRow">
              <div class="miniLeft">
                <div class="miniTitle">ğŸ“ å€é…æè²¨åœ°é»ï¼ˆFï¼‰</div>
                <div class="miniSub">${safeText(t.pickupAddr || t.pickup || '')}</div>
              </div>
            </div>
            <div class="miniRow">
              <div class="miniLeft">
                <div class="miniTitle">ğŸ æ”¶ä»¶äººåœ°å€ï¼ˆIï¼‰</div>
                <div class="miniSub">${safeText(t.recvAddr || '')}</div>
              </div>
            </div>
          </div>
        `;
        wrap.appendChild(det);
      });
    }
  }

  // ====== app logic ======
  let lineUserId = "";
  let currentOptions = null;

  async function initLiff(){
    setSubtitle("åˆå§‹åŒ–ä¸­â€¦");
    setPill('pillLiff', 'LIFFï¼šåˆå§‹åŒ–', 'warn');

    await liff.init({ liffId: LIFF_ID });

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    lineUserId = profile.userId || "";
    setPill('pillLiff', 'LIFFï¼šå·²ç™»å…¥', 'ok');
    el('userLine').textContent = `LINE IDï¼š${lineUserId || 'ï¼ˆç„¡æ³•å–å¾—ï¼‰'}`;

    if (!lineUserId) throw new Error("ç„¡æ³•å–å¾— LINE userId");

    await loadDaily(""); // é è¨­ D
  }

  async function loadDaily(dateTab){
    show('errCard', false);

    setSubtitle("è®€å–ä»»å‹™ä¸­â€¦");
    setPill('pillTasks', 'ä»»å‹™ï¼šè®€å–ä¸­', 'warn');

    const url = `${GAS_EXEC_URL}?mode=api_jsonp&uid=${encodeURIComponent(lineUserId)}&date=${encodeURIComponent(dateTab || '')}`;
    const payload = await jsonp(url);

    if (!payload || payload.ok === false) {
      const msg = safeText(payload && payload.message) || "è®€å–å¤±æ•—";
      // æœªç¶å®š â†’ æ‰“é–‹ç¶å®š UI
      if (msg.includes("å°šæœªç¶å®š") || msg.includes("enabled") || msg.includes("å¸æ©Ÿå°ç…§")) {
        setPill('pillBind', 'ç¶å®šï¼šæœªå®Œæˆ', 'warn');
        show('bindCard', true);
        show('taskCard', false);
        setSubtitle("è«‹å…ˆå®Œæˆç¶å®š");
        el('errDetail').textContent = msg;
        show('errCard', true);
        return;
      }

      // å…¶ä»–éŒ¯èª¤
      setPill('pillBind', 'ç¶å®šï¼šæœªçŸ¥', 'warn');
      show('bindCard', false);
      show('taskCard', false);
      setSubtitle("æš«æ™‚ç„¡æ³•è®€å–");
      el('errDetail').textContent = msg;
      show('errCard', true);
      return;
    }

    // success
    currentOptions = payload.options || null;

    // æ—¥æœŸä¸‹æ‹‰ï¼šå›ºå®š 5 å¤©
    if (currentOptions) {
      renderDateSelect(el('dateSelect'), currentOptions);
      if (dateTab) {
        const sel = el('dateSelect');
        for (let i=0;i<sel.options.length;i++){
          if (sel.options[i].value === dateTab) { sel.selectedIndex = i; break; }
        }
      }
      el('todayLine').textContent = `ä»Šå¤©ï¼š${safeText(currentOptions.baseToday || '')}`;
    }

    // ç¶å®šç‹€æ…‹
    setPill('pillBind', 'ç¶å®šï¼šå·²å®Œæˆ', 'ok');
    show('bindCard', false);

    // ä»»å‹™
    const me = payload.me || null;
    show('taskCard', true);

    if (me && me.hasTasks) setPill('pillTasks', 'ä»»å‹™ï¼šæœ‰', 'ok');
    else setPill('pillTasks', 'ä»»å‹™ï¼šç„¡', 'warn');

    if (me && me.driverName) {
      el('title').textContent = `ğŸšš ${me.driverName}ï½œä»Šæ—¥ä»»å‹™`;
    }

    renderTasks(me);
    setSubtitle(`å·²è¼‰å…¥ï¼ˆ${safeText(payload.chosenDate)}ï¼‰`);
  }

  async function bindSelf(){
    const raw = el('inpName').value;
    const name = normalizeNameInput(raw);
    if (!name) {
      alert("è«‹è¼¸å…¥å§“å");
      return;
    }

    setSubtitle("ç¶å®šä¸­â€¦");
    const url = `${GAS_EXEC_URL}?mode=bind_jsonp&uid=${encodeURIComponent(lineUserId)}&driverName=${encodeURIComponent(name)}`;
    const payload = await jsonp(url);

    if (!payload || payload.ok === false) {
      const msg = safeText(payload && payload.message) || "ç¶å®šå¤±æ•—";
      alert(msg);
      return;
    }

    setPill('pillBind', 'ç¶å®šï¼šå·²å®Œæˆ', 'ok');
    show('bindCard', false);
    await loadDaily(""); // ç¶å®šå¾Œç›´æ¥è¼‰å…¥é è¨­ D
  }

  // events
  el('btnReload').addEventListener('click', () => {
    const v = el('dateSelect').value || '';
    loadDaily(v);
  });

  el('dateSelect').addEventListener('change', () => {
    const v = el('dateSelect').value || '';
    if (!v) return;
    loadDaily(v);
  });

  el('btnBind').addEventListener('click', bindSelf);

  // start
  (async () => {
    try {
      await initLiff();
    } catch (e) {
      setPill('pillLiff', 'LIFFï¼šå¤±æ•—', 'bad');
      setSubtitle("åˆå§‹åŒ–å¤±æ•—");
      el('errDetail').textContent = safeText(e && e.message ? e.message : e);
      show('errCard', true);
    }
  })();
</script>
</body>
</html>


